import React, { useEffect, useRef } from "react";
import { motion } from "framer-motion";

const FuzzyWrapper = ({
  children,
  baseIntensity = 0.2,
  className = "",
}: {
  children: React.ReactNode;
  baseIntensity?: number;
  className?: string;
}) => {
  const canvasRef = useRef<HTMLCanvasElement>(null);

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;

    const ctx = canvas.getContext("2d");
    if (!ctx) return;

    let animationFrameId: number;

    const render = () => {
      const width = canvas.width;
      const height = canvas.height;

      ctx.clearRect(0, 0, width, height);

      const imageData = ctx.createImageData(width, height);
      const data = imageData.data;

      for (let i = 0; i < data.length; i += 4) {
        const intensity = Math.random() * baseIntensity;
        data[i] = intensity * 255;
        data[i + 1] = intensity * 255;
        data[i + 2] = intensity * 255;
        data[i + 3] = intensity * 255;
      }

      ctx.putImageData(imageData, 0, 0);
      animationFrameId = requestAnimationFrame(render);
    };

    render();

    return () => {
      cancelAnimationFrame(animationFrameId);
    };
  }, [baseIntensity]);

  return (
    <div className={`relative ${className}`}>
      <canvas
        ref={canvasRef}
        className="pointer-events-none absolute inset-0 w-full h-full"
        width={800}
        height={232}
      />
      {children}
    </div>
  );
};

const shake = {
  initial: { x: 0, y: 0, rotate: 0 },
  animate: {
    x: [0, -2, 2, -2, 2, 0],
    y: [0, 2, -2, 2, -2, 0],
    rotate: [0, -0.5, 0.5, -0.5, 0.5, 0],
    transition: {
      duration: 0.5,
      repeat: Infinity,
      repeatDelay: 0.5,
    },
  },
};

interface Glitchy404Props {
  width?: number;
  height?: number;
  color?: string;
}

export function Glitchy404({
  width = 860,
  height = 232,
  color = "#fff",
}: Glitchy404Props) {
  return (
    <FuzzyWrapper baseIntensity={0.4} className="cursor-pointer">
      <div className="relative">
        <svg
          width={width}
          height={height}
          viewBox="0 0 100 29"
          fill="white"
          xmlns="http://www.w3.org/2000/svg"
        >
          <motion.g variants={shake} initial="initial" animate="animate">
            <path d="M13.68 27.84C12.9333 27.84 12.2533 27.7067 11.64 27.44C11.0267 27.1733 10.5333 26.7867 10.16 26.28C9.78667 25.76 9.6 25.1333 9.6 24.4C9.6 23.6133 9.8 22.96 10.2 22.44C10.6 21.92 11.2 21.5467 12 21.32C12.8 21.08 13.8 21 15 21.24V20.76C15 20.0133 14.8133 19.4667 14.44 19.12C14.08 18.76 13.5733 18.58 12.92 18.58C12.4667 18.58 12.0267 18.6533 11.6 18.8C11.1867 18.9467 10.72 19.16 10.2 19.44L9.4 17.56C10.04 17.2 10.6933 16.92 11.36 16.72C12.04 16.5067 12.7867 16.4 13.6 16.4C15.08 16.4 16.2267 16.7467 17.04 17.44C17.8533 18.12 18.26 19.2 18.26 20.68V27.6H15.76L15.56 26.44C15.2 26.84 14.7467 27.1667 14.2 27.42C13.6667 27.6867 13.0933 27.8267 12.48 27.84H13.68ZM13.56 25.8C14.0267 25.8 14.44 25.7133 14.8 25.54C15.16 25.3533 15.4533 25.12 15.68 24.84V23C15.0667 22.8933 14.5467 22.86 14.12 22.9C13.6933 22.9267 13.3667 23.0267 13.14 23.2C12.9267 23.3733 12.82 23.6333 12.82 23.98C12.82 24.3533 12.9533 24.6467 13.22 24.86C13.5 25.0733 13.88 25.1867 14.36 25.2L13.56 25.8Z" />
          </motion.g>
          <motion.g variants={shake} initial="initial" animate="animate">
            <path d="M33.9525 16.6L28.9125 27.6H25.5125L20.4325 16.6H23.6725L26.8725 24.48L30.1525 16.6H33.9525Z" />
          </motion.g>
          <motion.g variants={shake} initial="initial" animate="animate">
            <path d="M44.305 27.84C43.5583 27.84 42.8783 27.7067 42.265 27.44C41.6517 27.1733 41.1583 26.7867 40.785 26.28C40.4117 25.76 40.225 25.1333 40.225 24.4C40.225 23.6133 40.425 22.96 40.825 22.44C41.225 21.92 41.825 21.5467 42.625 21.32C43.425 21.08 44.425 21 45.625 21.24V20.76C45.625 20.0133 45.4383 19.4667 45.065 19.12C44.705 18.76 44.1983 18.58 43.545 18.58C43.0917 18.58 42.6517 18.6533 42.225 18.8C41.8117 18.9467 41.345 19.16 40.825 19.44L40.025 17.56C40.665 17.2 41.3183 16.92 41.985 16.72C42.665 16.5067 43.4117 16.4 44.225 16.4C45.705 16.4 46.8517 16.7467 47.665 17.44C48.4783 18.12 48.885 19.2 48.885 20.68V27.6H46.385L46.185 26.44C45.825 26.84 45.3717 27.1667 44.825 27.42C44.2917 27.6867 43.7183 27.8267 43.105 27.84H44.305ZM44.185 25.8C44.6517 25.8 45.065 25.7133 45.425 25.54C45.785 25.3533 46.0783 25.12 46.305 24.84V23C45.6917 22.8933 45.1717 22.86 44.745 22.9C44.3183 22.9267 43.9917 23.0267 43.765 23.2C43.5517 23.3733 43.445 23.6333 43.445 23.98C43.445 24.3533 43.5783 24.6467 43.845 24.86C44.125 25.0733 44.505 25.1867 44.985 25.2L44.185 25.8Z" />
          </motion.g>
          <motion.g variants={shake} initial="initial" animate="animate">
            <path d="M51.5491 12.6H54.7891V27.6H51.5491V12.6Z" />
          </motion.g>
          <motion.g variants={shake} initial="initial" animate="animate">
            <path d="M57.7016 15.2C57.2216 15.2 56.8283 15.0533 56.5216 14.76C56.2283 14.4667 56.0816 14.1067 56.0816 13.68C56.0816 13.2533 56.2283 12.8933 56.5216 12.6C56.8283 12.3067 57.2216 12.16 57.7016 12.16C58.1816 12.16 58.5683 12.3067 58.8616 12.6C59.1683 12.8933 59.3216 13.2533 59.3216 13.68C59.3216 14.1067 59.1683 14.4667 58.8616 14.76C58.5683 15.0533 58.1816 15.2 57.7016 15.2ZM56.0816 16.6H59.3216V27.6H56.0816V16.6Z" />
          </motion.g>
          <motion.g variants={shake} initial="initial" animate="animate">
            <path d="M69.5941 27.6H66.5141V26.28C66.2341 26.7067 65.8408 27.04 65.3341 27.28C64.8408 27.52 64.3008 27.64 63.7141 27.64C62.6741 27.64 61.7941 27.3067 61.0741 26.64C60.3541 25.9733 59.9941 24.9467 59.9941 23.56V16.6H63.2341V22.84C63.2341 23.5733 63.3941 24.12 63.7141 24.48C64.0341 24.84 64.4808 25.02 65.0541 25.02C65.6541 25.02 66.1341 24.8267 66.4941 24.44C66.8541 24.04 67.0341 23.4533 67.0341 22.68V16.6H70.2741V27.6H69.5941Z" />
          </motion.g>
          <motion.g variants={shake} initial="initial" animate="animate">
            <path d="M81.747 22.44C81.747 22.6533 81.7337 22.88 81.707 23.12H74.347C74.4537 23.7467 74.7337 24.2333 75.187 24.58C75.6537 24.9133 76.2004 25.08 76.827 25.08C77.307 25.08 77.7537 25 78.167 24.84C78.5804 24.6667 78.987 24.42 79.387 24.1L80.667 26.04C80.107 26.4933 79.4804 26.8467 78.787 27.1C78.107 27.3533 77.3737 27.48 76.587 27.48C75.4537 27.48 74.467 27.2533 73.627 26.8C72.787 26.3467 72.1337 25.7133 71.667 24.9C71.2137 24.0867 70.987 23.1467 70.987 22.08C70.987 21.0267 71.207 20.0933 71.647 19.28C72.1004 18.4533 72.727 17.8067 73.527 17.34C74.327 16.8733 75.2537 16.64 76.307 16.64C77.3337 16.64 78.2337 16.8667 79.007 17.32C79.7937 17.7733 80.407 18.4133 80.847 19.24C81.2737 20.0533 81.4804 21.0067 81.467 22.1L81.747 22.44ZM76.307 18.84C75.787 18.84 75.3337 19 74.947 19.32C74.5737 19.64 74.3337 20.08 74.227 20.64H78.387C78.2804 20.08 78.0337 19.64 77.647 19.32C77.2737 19 76.827 18.84 76.307 18.84Z" />
          </motion.g>
          <motion.g variants={shake} initial="initial" animate="animate">
            <path d="M2.896 7.84C2.14933 7.84 1.46933 7.70667 0.856 7.44C0.242667 7.17333 -0.250667 6.78667 -0.624 6.28C-0.997333 5.76 -1.184 5.13333 -1.184 4.4C-1.184 3.61333 -0.984 2.96 -0.584 2.44C-0.184 1.92 0.416 1.54667 1.216 1.32C2.016 1.08 3.016 1 4.216 1.24V0.76C4.216 0.0133333 4.02933 -0.533333 3.656 -0.88C3.296 -1.24 2.78933 -1.42 2.136 -1.42C1.68267 -1.42 1.24267 -1.34667 0.816 -1.2C0.402667 -1.05333 -0.064 -0.84 -0.584 -0.56L-1.384 -2.44C-0.744 -2.8 -0.0906666 -3.08 0.576 -3.28C1.256 -3.49333 2.00267 -3.6 2.816 -3.6C4.296 -3.6 5.44267 -3.25333 6.256 -2.56C7.06933 -1.88 7.476 -0.8 7.476 0.68V7.6H4.976L4.776 6.44C4.416 6.84 3.96267 7.16667 3.416 7.42C2.88267 7.68667 2.30933 7.82667 1.696 7.84H2.896ZM2.776 5.8C3.24267 5.8 3.656 5.71333 4.016 5.54C4.376 5.35333 4.66933 5.12 4.896 4.84V3C4.28267 2.89333 3.76267 2.86 3.336 2.9C2.90933 2.92667 2.58267 3.02667 2.356 3.2C2.14267 3.37333 2.036 3.63333 2.036 3.98C2.036 4.35333 2.16933 4.64667 2.436 4.86C2.716 5.07333 3.096 5.18667 3.576 5.2L2.776 5.8Z" />
          </motion.g>
          <motion.g variants={shake} initial="initial" animate="animate">
            <path d="M19.7645 7.6L16.4845 3.6V7.6H13.2445V-7.4H16.4845V3L19.6045 -3.4H23.1645L19.2845 3.2L23.4445 7.6H19.7645Z" />
          </motion.g>
          <motion.g variants={shake} initial="initial" animate="animate">
            <path d="M33.917 2.44C33.917 2.65333 33.9037 2.88 33.877 3.12H26.517C26.6237 3.74667 26.9037 4.23333 27.357 4.58C27.8237 4.91333 28.3703 5.08 28.997 5.08C29.477 5.08 29.9237 5 30.337 4.84C30.7503 4.66667 31.157 4.42 31.557 4.1L32.837 6.04C32.277 6.49333 31.6503 6.84667 30.957 7.1C30.277 7.35333 29.5437 7.48 28.757 7.48C27.6237 7.48 26.637 7.25333 25.797 6.8C24.957 6.34667 24.3037 5.71333 23.837 4.9C23.3837 4.08667 23.157 3.14667 23.157 2.08C23.157 1.02667 23.377 0.0933334 23.817 -0.72C24.2703 -1.54667 24.897 -2.19333 25.697 -2.66C26.497 -3.12667 27.4237 -3.36 28.477 -3.36C29.5037 -3.36 30.4037 -3.13333 31.177 -2.68C31.9637 -2.22667 32.577 -1.58667 33.017 -0.76C33.4437 0.0533334 33.6503 1.00667 33.637 2.1L33.917 2.44ZM28.477 -1.16C27.957 -1.16 27.5037 -1 27.117 -0.68C26.7437 -0.36 26.5037 0.0799999 26.397 0.64H30.557C30.4503 0.0799999 30.2037 -0.36 29.817 -0.68C29.4437 -1 28.997 -1.16 28.477 -1.16Z" />
          </motion.g>
          <motion.g variants={shake} initial="initial" animate="animate">
            <path d="M42.2696 7.6L38.9896 3.6V7.6H35.7496V-7.4H38.9896V3L42.1096 -3.4H45.6696L41.7896 3.2L45.9496 7.6H42.2696Z" />
          </motion.g>
          <motion.g variants={shake} initial="initial" animate="animate">
            <path d="M56.422 2.44C56.422 2.65333 56.4087 2.88 56.382 3.12H49.022C49.1287 3.74667 49.4087 4.23333 49.862 4.58C50.3287 4.91333 50.8753 5.08 51.502 5.08C51.982 5.08 52.4287 5 52.842 4.84C53.2553 4.66667 53.662 4.42 54.062 4.1L55.342 6.04C54.782 6.49333 54.1553 6.84667 53.462 7.1C52.782 7.35333 52.0487 7.48 51.262 7.48C50.1287 7.48 49.142 7.25333 48.302 6.8C47.462 6.34667 46.8087 5.71333 46.342 4.9C45.8887 4.08667 45.662 3.14667 45.662 2.08C45.662 1.02667 45.882 0.0933334 46.322 -0.72C46.7753 -1.54667 47.402 -2.19333 48.202 -2.66C49.002 -3.12667 49.9287 -3.36 50.982 -3.36C52.0087 -3.36 52.9087 -3.13333 53.682 -2.68C54.4687 -2.22667 55.082 -1.58667 55.522 -0.76C55.9487 0.0533334 56.1553 1.00667 56.142 2.1L56.422 2.44ZM50.982 -1.16C50.462 -1.16 50.0087 -1 49.622 -0.68C49.2487 -0.36 49.0087 0.0799999 48.902 0.64H53.062C52.9553 0.0799999 52.7087 -0.36 52.322 -0.68C51.9487 -1 51.502 -1.16 50.982 -1.16Z" />
          </motion.g>
          <motion.g variants={shake} initial="initial" animate="animate">
            <path d="M66.4145 7.6L63.1345 3.6V7.6H59.8945V-7.4H63.1345V3L66.2545 -3.4H69.8145L65.9345 3.2L70.0945 7.6H66.4145Z" />
          </motion.g>
          <motion.g variants={shake} initial="initial" animate="animate">
            <path d="M80.5671 2.44C80.5671 2.65333 80.5537 2.88 80.5271 3.12H73.1671C73.2737 3.74667 73.5537 4.23333 74.0071 4.58C74.4737 4.91333 75.0204 5.08 75.6471 5.08C76.1271 5.08 76.5737 5 76.9871 4.84C77.4004 4.66667 77.8071 4.42 78.2071 4.1L79.4871 6.04C78.9271 6.49333 78.3004 6.84667 77.6071 7.1C76.9271 7.35333 76.1937 7.48 75.4071 7.48C74.2737 7.48 73.2871 7.25333 72.4471 6.8C71.6071 6.34667 70.9537 5.71333 70.4871 4.9C70.0337 4.08667 69.8071 3.14667 69.8071 2.08C69.8071 1.02667 70.0271 0.0933334 70.4671 -0.72C70.9204 -1.54667 71.5471 -2.19333 72.3471 -2.66C73.1471 -3.12667 74.0737 -3.36 75.1271 -3.36C76.1537 -3.36 77.0537 -3.13333 77.8271 -2.68C78.6137 -2.22667 79.2271 -1.58667 79.6671 -0.76C80.0937 0.0533334 80.3004 1.00667 80.2871 2.1L80.5671 2.44ZM75.1271 -1.16C74.6071 -1.16 74.1537 -1 73.7671 -0.68C73.3937 -0.36 73.1537 0.0799999 73.0471 0.64H77.2071C77.1004 0.0799999 76.8537 -0.36 76.4671 -0.68C76.0937 -1 75.6471 -1.16 75.1271 -1.16Z" />
          </motion.g>
          <motion.g variants={shake} initial="initial" animate="animate">
            <path d="M89.7196 7.6L86.4396 3.6V7.6H83.1996V-7.4H86.4396V3L89.5596 -3.4H93.1196L89.2396 3.2L93.3996 7.6H89.7196Z" />
          </motion.g>
          <motion.g variants={shake} initial="initial" animate="animate">
            <path d="M2.896 27.84C2.14933 27.84 1.46933 27.7067 0.856 27.44C0.242667 27.1733 -0.250667 26.7867 -0.624 26.28C-0.997333 25.76 -1.184 25.1333 -1.184 24.4C-1.184 23.6133 -0.984 22.96 -0.584 22.44C-0.184 21.92 0.416 21.5467 1.216 21.32C2.016 21.08 3.016 21 4.216 21.24V20.76C4.216 20.0133 4.02933 19.4667 3.656 19.12C3.296 18.76 2.78933 18.58 2.136 18.58C1.68267 18.58 1.24267 18.6533 0.816 18.8C0.402667 18.9467 -0.064 19.16 -0.584 19.44L-1.384 17.56C-0.744 17.2 -0.0906666 16.92 0.576 16.72C1.256 16.5067 2.00267 16.4 2.816 16.4C4.296 16.4 5.44267 16.7467 6.256 17.44C7.06933 18.12 7.476 19.2 7.476 20.68V27.6H4.976L4.776 26.44C4.416 26.84 3.96267 27.1667 3.416 27.42C2.88267 27.6867 2.30933 27.8267 1.696 27.84H2.896ZM2.776 25.8C3.24267 25.8 3.656 25.7133 4.016 25.54C4.376 25.3533 4.66933 25.12 4.896 24.84V23C4.28267 22.8933 3.76267 22.86 3.336 22.9C2.90933 22.92 2.58267 23.0267 2.356 23.2C2.14267 23.3733 2.036 23.6333 2.036 23.98C2.036 24.3533 2.16933 24.6467 2.436 24.86C2.716 25.0733 3.096 25.1867 3.576 25.2L2.776 25.8Z" />
          </motion.g>
          <motion.g variants={shake} initial="initial" animate="animate">
            <path d="M19.7645 27.6L16.4845 23.6V27.6H13.2445V12.6H16.4845V23L19.6045 16.6H23.1645L19.2845 23.2L23.4445 27.6H19.7645Z" />
          </motion.g>
          <motion.g variants={shake} initial="initial" animate="animate">
            <path d="M33.917 22.44C33.917 22.6533 33.9037 22.88 33.877 23.12H26.517C26.6237 23.7467 26.9037 24.2333 27.357 24.58C27.8237 24.9133 28.3703 25.08 28.997 25.08C29.477 25.08 29.9237 25 30.337 24.84C30.7503 24.6667 31.157 24.42 31.557 24.1L32.837 26.04C32.277 26.4933 31.6503 26.8467 30.957 27.1C30.277 27.3533 29.5437 27.48 28.757 27.48C27.6237 27.48 26.637 27.2533 25.797 26.8C24.957 26.3467 24.3037 25.7133 23.837 24.9C23.3837 24.0867 23.157 23.1467 23.157 22.08C23.157 21.0267 23.377 20.0933 23.817 19.28C24.2703 18.4533 24.897 17.8067 25.697 17.34C26.497 16.8733 27.4237 16.64 28.477 16.64C29.5037 16.64 30.4037 16.8667 31.177 17.32C31.9637 17.7733 32.577 18.4133 33.017 19.24C33.4437 20.0533 33.6503 21.0067 33.637 22.1L33.917 22.44ZM28.477 18.84C27.957 18.84 27.5037 19 27.117 19.32C26.7437 19.64 26.5037 20.08 26.397 20.64H30.557C30.4503 20.08 30.2037 19.64 29.817 19.32C29.4437 19 28.997 18.84 28.477 18.84Z" />
          </motion.g>
        </svg>
      </div>
    </FuzzyWrapper>
  );
}
